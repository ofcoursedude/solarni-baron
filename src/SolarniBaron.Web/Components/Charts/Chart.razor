@inject IJSRuntime JSRuntime

<canvas id="@Id"></canvas>

@code {

    public enum ChartType
    {
        Pie,
        Bar,
        Line
    }

    [Parameter]
    public string Id { get; set; }

    [Parameter]
    public ChartType Type { get; set; }

    [Parameter]
    public decimal[] Data { get; set; }

    [Parameter]
    public decimal[] Breakpoints { get; set; }

    [Parameter]
    public int HighlightIndex { get; set; }

    /*[Parameter]
    public string[] BackgroundColor { get; set; }*/

    [Parameter]
    public string[] Labels { get; set; }

    [Parameter]
    public EventCallback OnRendered { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
    // Here we create an anonymous type with all the options 
    // that need to be sent to Chart.js
        if (firstRender)
        {
            var radiuses = Enumerable.Range(0, Data.Length).Select(_ => 4).ToArray();
            radiuses[HighlightIndex] = 8;

            var colors = new string[Data.Length];
            for (var i = 0; i < Data.Length; i++)
            {
                // Find index of the breakpoint that is closest less than to the current value
                var index = Breakpoints.Select((x, j) => new { x, j }).Where(_ => _.x <= Data[i]).MaxBy(_ => _.x)?.j ?? 0;
                colors[i] = index switch
                {
                    0 => "red",
                    1 => "orange",
                    2 => "yellow",
                    3 => "green",
                    _ => "black"
                };
            }
            
            var config = new
            {
                Type = Type.ToString().ToLower(),
                Options = new
                {
                    Responsive = true
                },
                Data = new
                {
                    Datasets = new[]
                    {
                        new {Data = Data, Label="VÃ½hled cen (EUR/MWh)", PointRadius = radiuses, PointBackgroundColor = colors}
                    },
                    Labels = Labels
                }
            };

            await JSRuntime.InvokeVoidAsync("setup", Id, config);
            // await OnRendered.InvokeAsync();
        }
    }

}